const Koa = require('koa');
const Router = require('@koa/router');
const app = new Koa();
const router = new Router();

// 假设我们有一个函数来获取分页数据，这里只是一个示例
async function getPaginatedData(page, pageSize) {
    // 这里应该是数据库查询逻辑
    // 例如使用MongoDB: collection.find().skip((page - 1) * pageSize).limit(pageSize)
    // 返回查询结果和总记录数
    return {
        data: [], // 查询到的数据
        total: 100 // 假设总共有100条记录
    };
}

router.get('/data', async (ctx) => {
    // 获取分页参数
    let page = parseInt(ctx.request.query.page) || 1;
    let pageSize = parseInt(ctx.request.query.pageSize) || 10;

    // 获取分页数据
    const { data, total } = await getPaginatedData(page, pageSize);

    // 计算总页数
    const totalPages = Math.ceil(total / pageSize);

    // 发送响应
    ctx.body = {
        page,
        pageSize,
        totalPages,
        total,
        data
    };
});

app.use(router.routes()).use(router.allowedMethods());

app.listen(3000, () => {
    console.log('Server running on http://localhost:3000');
});
